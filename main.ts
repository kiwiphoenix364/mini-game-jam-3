controller.player2.onButtonEvent(ControllerButton.Down, ControllerButtonEvent.Released, function () {
    cameraOffset += 180
    heading += 180
    mirroring = false
})
function drawSprites () {
    // renderer.place3dImage(ballImage, 10, 73, 0, 1)
    // renderer.place3dImage(ballImage, 11, 72, 0, 1)
    for (let i = 0; i <= treeX.length; i++) {
    	
    }
    for (let index = 0; index <= objtype.length - 1; index++) {
        renderer.place3dImage(objtype[index], objx[index], objy[index], objh[index], objtype[index].width)
    }
}
// console.log("Number of trees=" + treeX.length)
function initializeTrack () {
    treeX = []
    treeY = []
    for (let x = 0; x <= trackImage.width - 1; x++) {
        for (let y = 0; y <= trackImage.height - 1; y++) {
            if (trackImage.getPixel(x, y) == 1) {
                treeX.push(x)
                treeY.push(y)
            }
        }
    }
}
function configure () {
    renderer.setBackgroundImage(assets.image`background`)
renderer.setZClipFar(zFar)
controller.player1.analog = true
}
controller.A.onEvent(ControllerButtonEvent.Pressed, function () {
    Start_LVL(1)
})
controller.B.onEvent(ControllerButtonEvent.Pressed, function () {
    timer.background(function () {
        for (let index = 0; index < 20; index++) {
            carYOffset += -0.16
            pause(1)
        }
        for (let index = 0; index < 20; index++) {
            carYOffset += 0.16
            pause(1)
        }
        if (controller.left.isPressed()) {
            drift = "l"
        } else if (controller.right.isPressed()) {
            drift = "r"
        }
    })
})
controller.menu.onEvent(ControllerButtonEvent.Pressed, function () {
    stats.turnStats(true)
})
function Start_LVL (LVL_NUM: number) {
    tiles.setCurrentTilemap(tilemap`level1`)
    trackImage = image.create(4080, 4080)
    redrawImg.GenerateImage()
    configure()
    arrayx2 = []
    arrayy2 = []
    arrayh2 = []
    carAngularVelocity = 0
    throttle = 0
    let py = 0
let px = 0
pxPrev = px
    pyPrev = py
    // How far behind the player should the camera be placed?
    followDistance = 40
    // Horizontal field of view in degrees. See backgroundImage comments,
    // it should be matched to the background image width.
    fov = 90
    // Y position of the horizon. Must match the backgroundImage (half) height.
    horizonY = 30
    // Z near and far (horizon) view distances
    zNear = 30
    zFar = 300
    // Color used for drawing ground outside the track texture.
    outsideTrackColor = 8
    carDragForward = 0.03
    carDragSideways = 0.15
    carDragSidewaysDrift = 0.04
    carDragOffroad = 0.2
    carAngularDrag = 0.85
    carAngularDragDrift = 0.95
    hOffset = -18
    hJumpSpeed = -20
    hAccel = 0.2
    arrayx = [
    -4,
    4,
    -4,
    -4,
    4,
    4,
    -4,
    4,
    4,
    3,
    -4,
    -3,
    4,
    3,
    -4,
    -3,
    -3,
    -3,
    3,
    3,
    3,
    -3,
    3,
    -3,
    -2,
    -3,
    -3,
    -1,
    -1,
    -2,
    2,
    3,
    3,
    1,
    1,
    2
    ]
    arrayy = [
    4,
    4,
    4,
    4,
    4,
    4,
    4,
    4,
    4,
    -4,
    4,
    -4,
    4,
    -4,
    4,
    -4,
    -4,
    -4,
    -4,
    -4,
    -4,
    -4,
    -4,
    -4,
    4,
    4,
    4,
    4,
    4,
    4,
    4,
    4,
    4,
    4,
    4,
    4
    ]
    arrayh = [
    0,
    0,
    0,
    4,
    0,
    4,
    4,
    4,
    0,
    0,
    0,
    0,
    4,
    3,
    4,
    3,
    0,
    3,
    0,
    3,
    0,
    0,
    3,
    3,
    3,
    2,
    2,
    2,
    2,
    3,
    3,
    2,
    2,
    2,
    2,
    3
    ]
    heading = 180
    objx = []
    objy = []
    objh = []
    objtype = []
    objIdx = []
    coinX = []
    coinY = []
    coinH = []
    for (let index = 0; index <= 4; index++) {
        coinX.push((0 - Math.cos((72 * index + 18) * Math.PI / 180)) * 8)
        coinH.push(Math.sin((72 * index + 18) * Math.PI / 180) * 8)
        coinY.push(-1)
        coinX.push((0 - Math.cos((72 * (index + 1) + 18) * Math.PI / 180)) * 8)
        coinH.push(Math.sin((72 * (index + 1) + 18) * Math.PI / 180) * 8)
        coinY.push(-1)
        coinX.push((0 - Math.cos((72 * index + 18) * Math.PI / 180)) * 8)
        coinH.push(Math.sin((72 * index + 18) * Math.PI / 180) * 8)
        coinY.push(1)
        coinX.push((0 - Math.cos((72 * (index + 1) + 18) * Math.PI / 180)) * 8)
        coinH.push(Math.sin((72 * (index + 1) + 18) * Math.PI / 180) * 8)
        coinY.push(1)
        coinX.push((0 - Math.cos((72 * index + 18) * Math.PI / 180)) * 8)
        coinH.push(Math.sin((72 * index + 18) * Math.PI / 180) * 8)
        coinY.push(1)
        coinX.push((0 - Math.cos((72 * index + 18) * Math.PI / 180)) * 8)
        coinH.push(Math.sin((72 * index + 18) * Math.PI / 180) * 8)
        coinY.push(-1)
    }
    coinXMap = []
    coinYMap = []
    initializeTrack()
    tileUtil.unloadTilemap()
    tiles.setCurrentTilemap(tilemap`level5`)
    CPUPX = []
    CPUPY = []
    CPUAngle = [
    0,
    0,
    0,
    0,
    0,
    0,
    0
    ]
    CPUpos = [
    0,
    0,
    0,
    0,
    0,
    0,
    0
    ]
    CPUSpeed = [
    0,
    0,
    0,
    0,
    0,
    0,
    0
    ]
    CPUSpeed = [
    0,
    0,
    0,
    0,
    0,
    0,
    0
    ]
    CPUTempX = [
    0,
    0,
    0,
    0,
    0,
    0,
    0
    ]
    CPUTempY = [
    0,
    0,
    0,
    0,
    0,
    0,
    0
    ]
    for (let value of tiles.getTilesByType(assets.tile`myTile3`)) {
        for (let index = 0; index <= 7; index++) {
            if (index < 4) {
                CPUPX.push(value.x + 32 - index * 16)
                CPUPY.push(value.y - 16 - index * 8)
            } else if (index < 7) {
                CPUPX.push(value.x + 96 - index * 16)
                CPUPY.push(value.y - 16 - index * 8)
            } else {
                px = value.x + 96 - index * 16
                py = value.y - 16 - index * 8
                pxPrev = value.x + 96 - index * 16
                pyPrev = value.y - 16 - index * 8
            }
        }
    }
    for (let value of tiles.getTilesByType(assets.tile`myTile`)) {
        coinXMap.push(value.x + 0)
        coinYMap.push(value.y + 0)
    }
    for (let index = 0; index <= 7; index++) {
        dis = 99999
        for (let value of tiles.getTilesByType(assets.tile`myTile1`)) {
            if (dis > Math.sqrt((CPUPX[index] - value.x) * (CPUPX[index] - value.x) + (CPUPY[index] - value.y) * (CPUPY[index] - value.y))) {
                dis = Math.sqrt((CPUPX[index] - value.x) * (CPUPX[index] - value.x) + (CPUPY[index] - value.y) * (CPUPY[index] - value.y))
                CPUTempX[index] = value.x
                CPUTempY[index] = value.y
            }
        }
        CPUpos[index] = 1
    }
    raceStarted = false
    for (let index = 0; index < 90; index++) {
        pause(1)
        cameraOffset += 4
        heading += 4
    }
    pause(1000)
    raceStarted = true
    renderer.setUp(drawSprites)
renderer.placePlayerSprite(carSprite, 12, 17)
}
controller.player2.onButtonEvent(ControllerButton.Down, ControllerButtonEvent.Pressed, function () {
    cameraOffset += 180
    heading += 180
    mirroring = true
})
controller.B.onEvent(ControllerButtonEvent.Released, function () {
    drift = ""
})
let prevAngle = 0
let attemptCameraOffset = 0
let carVy = 0
let carVx = 0
let fwdY = 0
let fwdX = 0
let carPower = 0
let coinRotation = 0
let Max = 0
let drift = ""
let carYOffset = 0
let treeY: number[] = []
let treeX: number[] = []
let mirroring = false
let cameraOffset = 0
let raceStarted = false
let dis = 0
let CPUTempY: number[] = []
let CPUTempX: number[] = []
let CPUSpeed: number[] = []
let CPUpos: number[] = []
let CPUAngle: number[] = []
let CPUPY: number[] = []
let CPUPX: number[] = []
let coinYMap: number[] = []
let coinXMap: number[] = []
let coinH: number[] = []
let coinY: number[] = []
let coinX: number[] = []
let objIdx: number[] = []
let objtype: Image[] = []
let objh: number[] = []
let objy: number[] = []
let objx: number[] = []
let heading = 0
let arrayh: number[] = []
let arrayy: number[] = []
let arrayx: number[] = []
let hAccel = 0
let hJumpSpeed = 0
let hOffset = 0
let carAngularDragDrift = 0
let carAngularDrag = 0
let carDragOffroad = 0
let carDragSidewaysDrift = 0
let carDragSideways = 0
let carDragForward = 0
let outsideTrackColor = 0
let zFar = 0
let zNear = 0
let horizonY = 0
let fov = 0
let followDistance = 0
let pyPrev = 0
let pxPrev = 0
let throttle = 0
let carAngularVelocity = 0
let arrayh2: number[] = []
let arrayy2: number[] = []
let arrayx2: number[] = []
let trackImage: Image = null
tiles.setCurrentTilemap(tilemap`level1`)
trackImage = image.create(4080, 4080)
redrawImg.GenerateImage()
configure()
arrayx2 = []
arrayy2 = []
arrayh2 = []
carAngularVelocity = 0
throttle = 0
let py = 0
let px = 0
let mySprite = sprites.create(img`
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    `, SpriteKind.Player)
mySprite.setFlag(SpriteFlag.RelativeToCamera, true)
mySprite.z = 500
let carSprite = sprites.create(assets.image`car`, SpriteKind.Player)
carSprite.z = 200
pxPrev = px
pyPrev = py
// How far behind the player should the camera be placed?
followDistance = 40
// Horizontal field of view in degrees. See backgroundImage comments,
// it should be matched to the background image width.
fov = 90
// Y position of the horizon. Must match the backgroundImage (half) height.
horizonY = 30
// Z near and far (horizon) view distances
zNear = 30
zFar = 300
// Color used for drawing ground outside the track texture.
outsideTrackColor = 8
carDragForward = 0.03
carDragSideways = 0.15
carDragSidewaysDrift = 0.04
carDragOffroad = 0.2
carAngularDrag = 0.85
carAngularDragDrift = 0.95
hOffset = -18
hJumpSpeed = -20
hAccel = 0.2
arrayx = [
-4,
4,
-4,
-4,
4,
4,
-4,
4,
4,
3,
-4,
-3,
4,
3,
-4,
-3,
-3,
-3,
3,
3,
3,
-3,
3,
-3,
-2,
-3,
-3,
-1,
-1,
-2,
2,
3,
3,
1,
1,
2
]
arrayy = [
4,
4,
4,
4,
4,
4,
4,
4,
4,
-4,
4,
-4,
4,
-4,
4,
-4,
-4,
-4,
-4,
-4,
-4,
-4,
-4,
-4,
4,
4,
4,
4,
4,
4,
4,
4,
4,
4,
4,
4
]
arrayh = [
0,
0,
0,
4,
0,
4,
4,
4,
0,
0,
0,
0,
4,
3,
4,
3,
0,
3,
0,
3,
0,
0,
3,
3,
3,
2,
2,
2,
2,
3,
3,
2,
2,
2,
2,
3
]
heading = 180
objx = []
objy = []
objh = []
objtype = []
objIdx = []
coinX = []
coinY = []
coinH = []
for (let index = 0; index <= 4; index++) {
    coinX.push((0 - Math.cos((72 * index + 18) * Math.PI / 180)) * 8)
    coinH.push(Math.sin((72 * index + 18) * Math.PI / 180) * 8)
    coinY.push(-1)
    coinX.push((0 - Math.cos((72 * (index + 1) + 18) * Math.PI / 180)) * 8)
    coinH.push(Math.sin((72 * (index + 1) + 18) * Math.PI / 180) * 8)
    coinY.push(-1)
    coinX.push((0 - Math.cos((72 * index + 18) * Math.PI / 180)) * 8)
    coinH.push(Math.sin((72 * index + 18) * Math.PI / 180) * 8)
    coinY.push(1)
    coinX.push((0 - Math.cos((72 * (index + 1) + 18) * Math.PI / 180)) * 8)
    coinH.push(Math.sin((72 * (index + 1) + 18) * Math.PI / 180) * 8)
    coinY.push(1)
    coinX.push((0 - Math.cos((72 * index + 18) * Math.PI / 180)) * 8)
    coinH.push(Math.sin((72 * index + 18) * Math.PI / 180) * 8)
    coinY.push(1)
    coinX.push((0 - Math.cos((72 * index + 18) * Math.PI / 180)) * 8)
    coinH.push(Math.sin((72 * index + 18) * Math.PI / 180) * 8)
    coinY.push(-1)
}
coinXMap = []
coinYMap = []
initializeTrack()
tileUtil.unloadTilemap()
tiles.setCurrentTilemap(tilemap`level5`)
CPUPX = []
CPUPY = []
CPUAngle = [
0,
0,
0,
0,
0,
0,
0
]
CPUpos = [
0,
0,
0,
0,
0,
0,
0
]
CPUSpeed = [
0,
0,
0,
0,
0,
0,
0
]
CPUSpeed = [
0,
0,
0,
0,
0,
0,
0
]
CPUTempX = [
0,
0,
0,
0,
0,
0,
0
]
CPUTempY = [
0,
0,
0,
0,
0,
0,
0
]
for (let value of tiles.getTilesByType(assets.tile`myTile3`)) {
    for (let index = 0; index <= 7; index++) {
        if (index < 4) {
            CPUPX.push(value.x + 32 - index * 16)
            CPUPY.push(value.y - 16 - index * 8)
        } else if (index < 7) {
            CPUPX.push(value.x + 96 - index * 16)
            CPUPY.push(value.y - 16 - index * 8)
        } else {
            px = value.x + 96 - index * 16
            py = value.y - 16 - index * 8
            pxPrev = value.x + 96 - index * 16
            pyPrev = value.y - 16 - index * 8
        }
    }
}
for (let value of tiles.getTilesByType(assets.tile`myTile`)) {
    coinXMap.push(value.x + 0)
    coinYMap.push(value.y + 0)
}
for (let index = 0; index <= 7; index++) {
    dis = 99999
    for (let value of tiles.getTilesByType(assets.tile`myTile1`)) {
        if (dis > Math.sqrt((CPUPX[index] - value.x) * (CPUPX[index] - value.x) + (CPUPY[index] - value.y) * (CPUPY[index] - value.y))) {
            dis = Math.sqrt((CPUPX[index] - value.x) * (CPUPX[index] - value.x) + (CPUPY[index] - value.y) * (CPUPY[index] - value.y))
            CPUTempX[index] = value.x
            CPUTempY[index] = value.y
        }
    }
    CPUpos[index] = 1
}
raceStarted = false
for (let index = 0; index < 90; index++) {
    pause(1)
    cameraOffset += 4
    heading += 4
}
pause(1000)
raceStarted = true
renderer.setUp(drawSprites)
renderer.placePlayerSprite(carSprite, 12, 17)
game.onUpdate(function () {
    if (raceStarted) {
        mySprite.setImage(img`
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            `)
        if (drift != "" && Math.percentChance(25)) {
            objx.push(px)
            objy.push(py)
            objh.push(1)
            if (Math.percentChance(50)) {
                objtype.push(img`
                    . . 1 1 . . 
                    . 1 1 1 . . 
                    1 1 1 1 1 . 
                    d 1 1 1 1 1 
                    . d d 1 d d 
                    . . . d . . 
                    `)
                objIdx.push(0)
            } else {
                objtype.push(img`
                    . . 1 1 1 . 
                    1 1 1 1 1 1 
                    d 1 1 1 1 d 
                    . 1 1 1 d . 
                    . d d d . . 
                    . . . . . . 
                    `)
                objIdx.push(0)
            }
        }
        for (let index = 0; index <= objx.length; index++) {
            if (objIdx[index] == 0) {
                if (objh[index] > 0) {
                    objh[index] = objh[index] - 0.1
                } else {
                    objh.removeAt(index)
                    objx.removeAt(index)
                    objy.removeAt(index)
                    objtype[index] = img`
                        . 
                        `
                    objtype.removeAt(index)
                    objIdx.removeAt(index)
                }
            }
        }
        for (let index = 0; index <= 7; index++) {
            if (tiles.tileAtLocationEquals(tiles.getTileLocation(CPUPX[index] / 16, CPUPY[index] / 16), assets.tile`myTile0`)) {
                if (CPUpos[index] == 0) {
                    dis = 99999
                    for (let value of tiles.getTilesByType(assets.tile`myTile1`)) {
                        if (dis > Math.sqrt((CPUPX[index] - value.x) * (CPUPX[index] - value.x) + (CPUPY[index] - value.y) * (CPUPY[index] - value.y))) {
                            dis = Math.sqrt((CPUPX[index] - value.x) * (CPUPX[index] - value.x) + (CPUPY[index] - value.y) * (CPUPY[index] - value.y))
                            CPUTempX[index] = value.x
                            CPUTempY[index] = value.y
                        }
                    }
                }
                CPUpos[index] = 1
            } else if (tiles.tileAtLocationEquals(tiles.getTileLocation(CPUPX[index] / 16, CPUPY[index] / 16), assets.tile`myTile1`)) {
                if (CPUpos[index] == 1) {
                    dis = 99999
                    for (let value of tiles.getTilesByType(assets.tile`myTile2`)) {
                        if (dis > Math.sqrt((CPUPX[index] - value.x) * (CPUPX[index] - value.x) + (CPUPY[index] - value.y) * (CPUPY[index] - value.y))) {
                            dis = Math.sqrt((CPUPX[index] - value.x) * (CPUPX[index] - value.x) + (CPUPY[index] - value.y) * (CPUPY[index] - value.y))
                            CPUTempX[index] = value.x
                            CPUTempY[index] = value.y
                        }
                    }
                }
                CPUpos[index] = 2
            } else if (tiles.tileAtLocationEquals(tiles.getTileLocation(CPUPX[index] / 16, CPUPY[index] / 16), assets.tile`myTile2`)) {
                if (CPUpos[index] == 2) {
                    dis = 99999
                    for (let value of tiles.getTilesByType(assets.tile`myTile0`)) {
                        if (dis > Math.sqrt((CPUPX[index] - value.x) * (CPUPX[index] - value.x) + (CPUPY[index] - value.y) * (CPUPY[index] - value.y))) {
                            dis = Math.sqrt((CPUPX[index] - value.x) * (CPUPX[index] - value.x) + (CPUPY[index] - value.y) * (CPUPY[index] - value.y))
                            CPUTempX[index] = value.x
                            CPUTempY[index] = value.y
                        }
                    }
                }
                CPUpos[index] = 0
            }
            CPUSpeed[index] = 2
            Max = Math.max(Math.abs(CPUTempY[index] - CPUPY[index]), Math.abs(CPUTempX[index] - CPUPX[index]))
            CPUPX[index] = CPUPX[index] + Math.idiv(CPUTempX[index] - CPUPX[index], Max) * CPUSpeed[index]
            CPUPY[index] = CPUPY[index] + Math.idiv(CPUTempY[index] - CPUPY[index], Max) * CPUSpeed[index]
            CPUAngle[index] = spriteutils.radiansToDegrees(Math.atan2((CPUTempY[index] - CPUPY[index]) / Math.max(Math.abs(CPUTempY[index] - CPUPY[index]), Math.abs(CPUTempX[index] - CPUPX[index])), (CPUTempX[index] - CPUPX[index]) / Math.max(Math.abs(CPUTempY[index] - CPUPY[index]), Math.abs(CPUTempX[index] - CPUPX[index])))) + 90
        }
        for (let index = 0; index <= coinXMap.length; index++) {
            for (let index7 = 0; index7 <= coinX.length / 2; index7++) {
            	
            }
        }
        for (let index7 = 0; index7 <= arrayx.length / 2; index7++) {
            if (index7 < 12) {
                renderer.place3dLine(1, px + (arrayx[index7 * 2] * Math.cos((heading + cameraOffset) * Math.PI / 180) - arrayy[index7 * 2] * Math.sin((heading + cameraOffset) * Math.PI / 180)), py + (arrayy[index7 * 2] * Math.cos((heading + cameraOffset) * Math.PI / 180) + arrayx[index7 * 2] * Math.sin((heading + cameraOffset) * Math.PI / 180)), arrayh[index7 * 2] - carYOffset, px + (arrayx[index7 * 2 + 1] * Math.cos((heading + cameraOffset) * Math.PI / 180) - arrayy[index7 * 2 + 1] * Math.sin((heading + cameraOffset) * Math.PI / 180)), py + (arrayy[index7 * 2 + 1] * Math.cos((heading + cameraOffset) * Math.PI / 180) + arrayx[index7 * 2 + 1] * Math.sin((heading + cameraOffset) * Math.PI / 180)), arrayh[index7 * 2 + 1] - carYOffset)
            } else {
                renderer.place3dLine(9, px + (arrayx[index7 * 2] * Math.cos((heading + cameraOffset) * Math.PI / 180) - arrayy[index7 * 2] * Math.sin((heading + cameraOffset) * Math.PI / 180)), py + (arrayy[index7 * 2] * Math.cos((heading + cameraOffset) * Math.PI / 180) + arrayx[index7 * 2] * Math.sin((heading + cameraOffset) * Math.PI / 180)), arrayh[index7 * 2] - carYOffset, px + (arrayx[index7 * 2 + 1] * Math.cos((heading + cameraOffset) * Math.PI / 180) - arrayy[index7 * 2 + 1] * Math.sin((heading + cameraOffset) * Math.PI / 180)), py + (arrayy[index7 * 2 + 1] * Math.cos((heading + cameraOffset) * Math.PI / 180) + arrayx[index7 * 2 + 1] * Math.sin((heading + cameraOffset) * Math.PI / 180)), arrayh[index7 * 2 + 1] - carYOffset)
            }
        }
        for (let index = 0; index <= CPUPX.length; index++) {
            for (let index7 = 0; index7 <= arrayx.length / 2; index7++) {
                if (index7 < 12) {
                    if (Math.percentChance(Math.sqrt((CPUPX[index] - px) * (CPUPX[index] - px) + (CPUPY[index] - py) * (CPUPY[index] - py)) / 6)) {
                    	
                    } else {
                        renderer.place3dLine(1, CPUPX[index] + (arrayx[index7 * 2] * Math.cos(CPUAngle[index] * Math.PI / 180) - arrayy[index7 * 2] * Math.sin(CPUAngle[index] * Math.PI / 180)), CPUPY[index] + (arrayy[index7 * 2] * Math.cos(CPUAngle[index] * Math.PI / 180) + arrayx[index7 * 2] * Math.sin(CPUAngle[index] * Math.PI / 180)), arrayh[index7 * 2] - carYOffset, CPUPX[index] + (arrayx[index7 * 2 + 1] * Math.cos(CPUAngle[index] * Math.PI / 180) - arrayy[index7 * 2 + 1] * Math.sin(CPUAngle[index] * Math.PI / 180)), CPUPY[index] + (arrayy[index7 * 2 + 1] * Math.cos(CPUAngle[index] * Math.PI / 180) + arrayx[index7 * 2 + 1] * Math.sin(CPUAngle[index] * Math.PI / 180)), arrayh[index7 * 2 + 1])
                    }
                } else {
                    if (Math.percentChance(Math.sqrt((CPUPX[index] - px) * (CPUPX[index] - px) + (CPUPY[index] - py) * (CPUPY[index] - py)) / 2)) {
                    	
                    } else {
                        renderer.place3dLine(9, CPUPX[index] + (arrayx[index7 * 2] * Math.cos(CPUAngle[index] * Math.PI / 180) - arrayy[index7 * 2] * Math.sin(CPUAngle[index] * Math.PI / 180)), CPUPY[index] + (arrayy[index7 * 2] * Math.cos(CPUAngle[index] * Math.PI / 180) + arrayx[index7 * 2] * Math.sin(CPUAngle[index] * Math.PI / 180)), arrayh[index7 * 2] - carYOffset, CPUPX[index] + (arrayx[index7 * 2 + 1] * Math.cos(CPUAngle[index] * Math.PI / 180) - arrayy[index7 * 2 + 1] * Math.sin(CPUAngle[index] * Math.PI / 180)), CPUPY[index] + (arrayy[index7 * 2 + 1] * Math.cos(CPUAngle[index] * Math.PI / 180) + arrayx[index7 * 2 + 1] * Math.sin(CPUAngle[index] * Math.PI / 180)), arrayh[index7 * 2 + 1])
                    }
                }
            }
        }
        for (let index = 0; index <= 5; index++) {
            arrayx2.push(px + (arrayx[index * 2 + 24] * Math.cos((heading + cameraOffset) * Math.PI / 180) - arrayy[index * 2 + 24] * Math.sin((heading + cameraOffset) * Math.PI / 180)))
            arrayx2.push(px + (arrayx[index * 2 + (24 + 1)] * Math.cos((heading + cameraOffset) * Math.PI / 180) - arrayy[index * 2 + (24 + 1)] * Math.sin((heading + cameraOffset) * Math.PI / 180)))
            arrayy2.push(py + (arrayy[index * 2 + 24] * Math.cos((heading + cameraOffset) * Math.PI / 180) + arrayx[index * 2 + 24] * Math.sin((heading + cameraOffset) * Math.PI / 180)))
            arrayy2.push(py + (arrayy[index * 2 + (24 + 1)] * Math.cos((heading + cameraOffset) * Math.PI / 180) + arrayx[index * 2 + (24 + 1)] * Math.sin((heading + cameraOffset) * Math.PI / 180)))
            arrayh2.push(arrayh[index * 2 + 24] - carYOffset)
            arrayh2.push(arrayh[index * 2 + (24 + 1)] - carYOffset)
        }
        for (let index7 = 0; index7 <= arrayx2.length / 2; index7++) {
            renderer.place3dLine(9, arrayx2[index7 * 2], arrayy2[index7 * 2], arrayh2[index7 * 2], arrayx2[index7 * 2 + 1], arrayy2[index7 * 2 + 1], arrayh2[index7 * 2 + 1])
            renderer.place3dLine(9, arrayx2[index7 * 2], arrayy2[index7 * 2], arrayh2[index7 * 2], arrayx2[index7 * 2 + 12], arrayy2[index7 * 2 + 12], arrayh2[index7 * 2 + 12])
        }
        if (arrayx2.length >= 48) {
            for (let index = 0; index < 12; index++) {
                arrayx2.shift()
                arrayy2.shift()
                arrayh2.shift()
            }
        }
        coinRotation += 1
    }
})
game.onUpdate(function () {
    if (raceStarted) {
        if (mirroring) {
            heading += 180
            cameraOffset += 180
        }
        if (heading < 0) {
            heading += 360
        }
        if (heading >= 360) {
            heading += 0 - 360
        }
        if (drift == "l") {
            heading += carPower * 2 * (controller.dx(150) - 5)
            fwdX = Math.sin((heading + 30) * Math.PI / 180)
            fwdY = 0 - Math.cos((heading + 30) * Math.PI / 180)
        } else if (drift == "r") {
            heading += carPower * 2 * (controller.dx(150) + 5)
            fwdX = Math.sin((heading + 330) * Math.PI / 180)
            fwdY = 0 - Math.cos((heading + 330) * Math.PI / 180)
        } else {
            heading += carPower * 2 * controller.dx(300)
            fwdX = Math.sin(heading * Math.PI / 180)
            fwdY = 0 - Math.cos(heading * Math.PI / 180)
        }
        carPower = controller.dy(-5)
        carVx += carPower * 2 * fwdX
        carVy += carPower * 2 * fwdY
        carVx += Math.sin(heading * Math.PI / 180) / 80 * carPower
        carVy += (0 - Math.cos(heading * Math.PI / 180)) / 80 * carPower
        carVx += 0 - carVx / 15
        carVy += 0 - carVy / 15
        if (carVx > 0.04 && carVx < -0.04) {
        	
        }
        if (carVy > 0.04 && carVy < -0.04) {
        	
        }
        px += carVx
        py += carVy
        if (carVx > -0.04 && carVx < 0.04) {
            carVx = 0
        }
        if (carVy > -0.04 && carVy < 0.04) {
            carVy = 0
        }
        if (px < 0) {
            px = 0
        }
        if (py < 0) {
            py = 0
        }
        attemptCameraOffset = (heading - prevAngle) * 10
        prevAngle = heading
        if (cameraOffset < -180) {
            cameraOffset += 360
        } else if (cameraOffset > 180) {
            cameraOffset += -360
        } else {
        	
        }
        if (Math.round(cameraOffset) < Math.round(attemptCameraOffset)) {
            cameraOffset += 1
        } else if (Math.round(cameraOffset) > Math.round(attemptCameraOffset)) {
            cameraOffset += -1
        } else {
        	
        }
        if (mirroring) {
            heading += -180
            cameraOffset += -180
        }
        if (heading < 0) {
            heading += 360
        }
        if (heading >= 360) {
            heading += 0 - 360
        }
    }
})
