function setUpTrack2 () {
    pxPrev = px = 20
pyPrev = py = 35
heading = 0
}
function drawSprites () {
    // renderer.place3dImage(ballImage, 10, 73, 0, 1)
    // renderer.place3dImage(ballImage, 11, 72, 0, 1)
    for (let i = 0; i <= treeX.length; i++) {
    	
    }
}
// console.log("Number of trees=" + treeX.length)
function initializeTrack () {
    treeX = []
    treeY = []
    for (let x = 0; x <= trackImage.width - 1; x++) {
        for (let y = 0; y <= trackImage.height - 1; y++) {
            if (trackImage.getPixel(x, y) == 1) {
                treeX.push(x)
                treeY.push(y)
            }
        }
    }
}
controller.B.onEvent(ControllerButtonEvent.Pressed, function () {
    timer.background(function () {
        for (let index = 0; index < 20; index++) {
            carYOffset += -0.16
            pause(1)
        }
        for (let index = 0; index < 20; index++) {
            carYOffset += 0.16
            pause(1)
        }
    })
    if (controller.left.isPressed()) {
        drift = "l"
    } else if (controller.right.isPressed()) {
        drift = "r"
    }
})
function configure () {
    renderer.setBackgroundImage(assets.image`background`)
renderer.setZClipFar(zFar)
controller.player1.analog = true
}
controller.player2.onButtonEvent(ControllerButton.Down, ControllerButtonEvent.Pressed, function () {
    cameraOffset += 180
    heading += 180
    mirroring = true
})
controller.player2.onButtonEvent(ControllerButton.Down, ControllerButtonEvent.Released, function () {
    cameraOffset += 180
    heading += 180
    mirroring = false
})
controller.menu.onEvent(ControllerButtonEvent.Pressed, function () {
    stats.turnStats(true)
})
controller.B.onEvent(ControllerButtonEvent.Released, function () {
    drift = ""
})
let carVy = 0
let carVx = 0
let carPower = 0
let fwdY = 0
let fwdX = 0
let coinRotation = 0
let mirroring = false
let drift = ""
let carYOffset = 0
let treeY: number[] = []
let treeX: number[] = []
let cameraOffset = 0
let heading = 0
let trackImage: Image = null
let arrayx2: number[] = []
let arrayy2: number[] = []
let arrayh2: number[] = []
game.splash("Please Wait...", "A Few Seconds")
let carAngularVelocity = 0
let throttle = 0
let py = 0
let px = 0
let mySprite = sprites.create(img`
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    `, SpriteKind.Player)
mySprite.setFlag(SpriteFlag.RelativeToCamera, true)
mySprite.z = 500
let treeImage = assets.image`tree`
let ballImage = assets.image`ball`
tiles.setCurrentTilemap(tilemap`level1`)
trackImage = image.create(4080, 4080)
redrawImg.GenerateImage()
configure()
let carSprite = sprites.create(assets.image`car`, SpriteKind.Player)
carSprite.z = 200
let pxPrev = px
let pyPrev = py
// How far behind the player should the camera be placed?
let followDistance = 40
// Horizontal field of view in degrees. See backgroundImage comments,
// it should be matched to the background image width.
let fov = 90
// Y position of the horizon. Must match the backgroundImage (half) height.
let horizonY = 30
// Z near and far (horizon) view distances
let zNear = 30
let zFar = 300
// Color used for drawing ground outside the track texture.
let outsideTrackColor = 8
renderer.setUp(drawSprites)
renderer.placePlayerSprite(carSprite, 12, 17)
let carDragForward = 0.03
let carDragSideways = 0.15
let carDragSidewaysDrift = 0.04
let carDragOffroad = 0.2
let carAngularDrag = 0.85
let carAngularDragDrift = 0.95
setUpTrack2()
initializeTrack()
enum TerrainType {
    ROAD,
    OFFROAD,
    OBSTACLE,
    FINISH_LINE
}
let hOffset = -18
let hJumpSpeed = -20
let hAccel = 0.2
let arrayx = [
-4,
4,
-4,
-4,
4,
4,
-4,
4,
4,
3,
-4,
-3,
4,
3,
-4,
-3,
-3,
-3,
3,
3,
3,
-3,
3,
-3,
-2,
-3,
-3,
-1,
-1,
-2,
2,
3,
3,
1,
1,
2
]
let arrayy = [
4,
4,
4,
4,
4,
4,
4,
4,
4,
-4,
4,
-4,
4,
-4,
4,
-4,
-4,
-4,
-4,
-4,
-4,
-4,
-4,
-4,
4,
4,
4,
4,
4,
4,
4,
4,
4,
4,
4,
4
]
let arrayh = [
0,
0,
0,
4,
0,
4,
4,
4,
0,
0,
0,
0,
4,
3,
4,
3,
0,
3,
0,
3,
0,
0,
3,
3,
3,
2,
2,
2,
2,
3,
3,
2,
2,
2,
2,
3
]
heading = 180
timer.background(function () {
    for (let index = 0; index < 360; index++) {
        pause(1)
        cameraOffset += -1
        heading += 1
    }
})
let coinX: number[] = []
let coinY: number[] = []
let coinH: number[] = []
for (let index = 0; index <= 7; index++) {
    coinX.push((0 - Math.cos(45 * index * Math.PI / 180)) * 8)
    coinH.push(Math.sin(45 * index * Math.PI / 180) * 8)
    coinY.push(-1)
    coinX.push((0 - Math.cos(45 * (index + 1) * Math.PI / 180)) * 8)
    coinH.push(Math.sin(45 * (index + 1) * Math.PI / 180) * 8)
    coinY.push(-1)
    coinX.push((0 - Math.cos(45 * index * Math.PI / 180)) * 8)
    coinH.push(Math.sin(45 * index * Math.PI / 180) * 8)
    coinY.push(1)
    coinX.push((0 - Math.cos(45 * (index + 1) * Math.PI / 180)) * 8)
    coinH.push(Math.sin(45 * (index + 1) * Math.PI / 180) * 8)
    coinY.push(1)
    coinX.push((0 - Math.cos(45 * index * Math.PI / 180)) * 8)
    coinH.push(Math.sin(45 * index * Math.PI / 180) * 8)
    coinY.push(1)
    coinX.push((0 - Math.cos(45 * index * Math.PI / 180)) * 8)
    coinH.push(Math.sin(45 * index * Math.PI / 180) * 8)
    coinY.push(-1)
}
let coinXMap: number[] = []
let coinYMap: number[] = []
for (let value of tiles.getTilesByType(assets.tile`myTile`)) {
    coinXMap.push(value.x + 0)
    coinYMap.push(value.y + 0)
}
tileUtil.unloadTilemap()
game.onUpdate(function () {
    mySprite.setImage(img`
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        `)
    for (let index = 0; index <= coinXMap.length; index++) {
        for (let index7 = 0; index7 <= coinX.length / 2; index7++) {
            renderer.place3dLine(7, coinXMap[index] + (coinX[index7 * 2] * Math.cos(coinRotation * Math.PI / 180) - coinY[index7 * 2] * Math.sin(coinRotation * Math.PI / 180)), coinYMap[index] + (coinY[index7 * 2] * Math.cos(coinRotation * Math.PI / 180) + coinX[index7 * 2] * Math.sin(coinRotation * Math.PI / 180)), coinH[index7 * 2], coinXMap[index] + (coinX[index7 * 2 + 1] * Math.cos(coinRotation * Math.PI / 180) - coinY[index7 * 2 + 1] * Math.sin(coinRotation * Math.PI / 180)), coinYMap[index] + (coinY[index7 * 2 + 1] * Math.cos(coinRotation * Math.PI / 180) + coinX[index7 * 2 + 1] * Math.sin(coinRotation * Math.PI / 180)), coinH[index7 * 2 + 1])
        }
    }
    for (let index7 = 0; index7 <= arrayx.length / 2; index7++) {
        if (index7 < 12) {
            renderer.place3dLine(1, px + (arrayx[index7 * 2] * Math.cos((heading + cameraOffset) * Math.PI / 180) - arrayy[index7 * 2] * Math.sin((heading + cameraOffset) * Math.PI / 180)), py + (arrayy[index7 * 2] * Math.cos((heading + cameraOffset) * Math.PI / 180) + arrayx[index7 * 2] * Math.sin((heading + cameraOffset) * Math.PI / 180)), arrayh[index7 * 2] - carYOffset, px + (arrayx[index7 * 2 + 1] * Math.cos((heading + cameraOffset) * Math.PI / 180) - arrayy[index7 * 2 + 1] * Math.sin((heading + cameraOffset) * Math.PI / 180)), py + (arrayy[index7 * 2 + 1] * Math.cos((heading + cameraOffset) * Math.PI / 180) + arrayx[index7 * 2 + 1] * Math.sin((heading + cameraOffset) * Math.PI / 180)), arrayh[index7 * 2 + 1] - carYOffset)
        } else {
            renderer.place3dLine(9, px + (arrayx[index7 * 2] * Math.cos((heading + cameraOffset) * Math.PI / 180) - arrayy[index7 * 2] * Math.sin((heading + cameraOffset) * Math.PI / 180)), py + (arrayy[index7 * 2] * Math.cos((heading + cameraOffset) * Math.PI / 180) + arrayx[index7 * 2] * Math.sin((heading + cameraOffset) * Math.PI / 180)), arrayh[index7 * 2] - carYOffset, px + (arrayx[index7 * 2 + 1] * Math.cos((heading + cameraOffset) * Math.PI / 180) - arrayy[index7 * 2 + 1] * Math.sin((heading + cameraOffset) * Math.PI / 180)), py + (arrayy[index7 * 2 + 1] * Math.cos((heading + cameraOffset) * Math.PI / 180) + arrayx[index7 * 2 + 1] * Math.sin((heading + cameraOffset) * Math.PI / 180)), arrayh[index7 * 2 + 1] - carYOffset)
        }
    }
    for (let index = 0; index <= 5; index++) {
        arrayx2.push(px + (arrayx[index * 2 + 24] * Math.cos((heading + cameraOffset) * Math.PI / 180) - arrayy[index * 2 + 24] * Math.sin((heading + cameraOffset) * Math.PI / 180)))
        arrayx2.push(px + (arrayx[index * 2 + (24 + 1)] * Math.cos((heading + cameraOffset) * Math.PI / 180) - arrayy[index * 2 + (24 + 1)] * Math.sin((heading + cameraOffset) * Math.PI / 180)))
        arrayy2.push(py + (arrayy[index * 2 + 24] * Math.cos((heading + cameraOffset) * Math.PI / 180) + arrayx[index * 2 + 24] * Math.sin((heading + cameraOffset) * Math.PI / 180)))
        arrayy2.push(py + (arrayy[index * 2 + (24 + 1)] * Math.cos((heading + cameraOffset) * Math.PI / 180) + arrayx[index * 2 + (24 + 1)] * Math.sin((heading + cameraOffset) * Math.PI / 180)))
        arrayh2.push(arrayh[index * 2 + 24])
        arrayh2.push(arrayh[index * 2 + (24 + 1)])
    }
    for (let index7 = 0; index7 <= arrayx2.length / 2; index7++) {
        renderer.place3dLine(9, arrayx2[index7 * 2], arrayy2[index7 * 2], arrayh2[index7 * 2], arrayx2[index7 * 2 + 1], arrayy2[index7 * 2 + 1], arrayh2[index7 * 2 + 1])
        renderer.place3dLine(9, arrayx2[index7 * 2], arrayy2[index7 * 2], arrayh2[index7 * 2], arrayx2[index7 * 2 + 12], arrayy2[index7 * 2 + 12], arrayh2[index7 * 2 + 12])
    }
    if (arrayx2.length >= 48) {
        for (let index = 0; index < 12; index++) {
            arrayx2.shift()
            arrayy2.shift()
            arrayh2.shift()
        }
    }
    coinRotation += 1
})
game.onUpdate(function () {
    if (drift == "l") {
        fwdX = Math.sin((heading + -90) * Math.PI / 180)
        fwdY = 0 - Math.cos((heading + -90) * Math.PI / 180)
        heading += carPower * 2 * controller.dx(50)
    } else if (drift == "r") {
        fwdX = Math.sin((heading + 90) * Math.PI / 180)
        fwdY = 0 - Math.cos((heading + 90) * Math.PI / 180)
        heading += carPower * 2 * controller.dx(50)
    } else {
        fwdX = Math.sin(heading * Math.PI / 180)
        fwdY = 0 - Math.cos(heading * Math.PI / 180)
        heading += carPower * 2 * controller.dx(300)
    }
    if (mirroring) {
        heading += 180
    }
    carPower = controller.dy(-5)
    if (heading < 0) {
        heading += 360
    }
    if (heading >= 360) {
        heading += 0 - 360
    }
    carVx += carPower * fwdX
    carVy += carPower * fwdY
    if (drift == "l") {
        carVx += carPower * -1 * Math.sin((heading + 270) * Math.PI / 180)
        carVy += carPower * -1 * (0 - Math.cos((heading + 270) * Math.PI / 180))
    } else if (drift == "r") {
        carVx += (0 - carPower * 1) * Math.sin((heading + 270) * Math.PI / 180)
        carVy += (0 - carPower * 1) * (0 - Math.cos((heading + 270) * Math.PI / 180))
    } else {
        carVx += carPower * controller.dx(0) * Math.sin((heading + 270) * Math.PI / 180)
        carVy += carPower * controller.dx(0) * (0 - Math.cos((heading + 270) * Math.PI / 180))
    }
    carVx += Math.sin(heading * Math.PI / 180) / 50 * carPower
    carVy += (0 - Math.cos(heading * Math.PI / 180)) / 50 * carPower
    if (drift == "l" || drift == "r") {
        carVx += 0 - carVx / 35
        carVy += 0 - carVy / 35
    } else {
        carVx += 0 - carVx / 55
        carVy += 0 - carVy / 55
    }
    if (carVx > 0.04 && carVx < -0.04) {
    	
    }
    if (carVy > 0.04 && carVy < -0.04) {
    	
    }
    px += carVx
    py += carVy
    if (carVx > -0.04 && carVx < 0.04) {
        carVx = 0
    }
    if (carVy > -0.04 && carVy < 0.04) {
        carVy = 0
    }
    if (px < 0) {
        px = 0
    }
    if (py < 0) {
        py = 0
    }
    if (mirroring) {
        heading += -180
    }
    if (heading < 0) {
        heading += 360
    }
    if (heading >= 360) {
        heading += 0 - 360
    }
})
game.onUpdateInterval(50, function () {
	
})
